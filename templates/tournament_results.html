{% extends "base.html" %}

{% block title %}{{ tournament.name }} - Final Results{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="text-center mb-5">
                <h1>üèÜ {{ tournament.name }}</h1>
                <h2 class="text-success">Tournament Completed!</h2>
                <p class="lead">Final standings and statistics</p>
            </div>
        </div>
    </div>

    <!-- Top 3 Podium -->
    {% if player_stats|length >= 3 %}
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="text-center mb-4">ü•á Final Standings ü•á</h3>
            <div class="row text-center">
                <!-- 2nd Place -->
                <div class="col-md-4 mb-3">
                    <div class="card h-100 border-warning">
                        <div class="card-body">
                            <div class="position-relative">
                                <div class="podium podium-silver">
                                    <span class="position-number">2</span>
                                </div>
                                <h4 class="card-title text-warning">ü•à 2nd Place</h4>
                                <h5 class="card-subtitle mb-2">{{ player_stats[1].player.name }}</h5>
                                <div class="stats">
                                    <p class="mb-1"><strong>Wins:</strong> {{ player_stats[1].wins }}</p>
                                    <p class="mb-1"><strong>Total Score:</strong> {{ player_stats[1].total_score }}</p>
                                    <p class="mb-1"><strong>Avg Score:</strong> {{ "%.1f"|format(player_stats[1].avg_score) }}</p>
                                    <p class="mb-0"><strong>Matches:</strong> {{ player_stats[1].matches_played }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1st Place -->
                <div class="col-md-4 mb-3">
                    <div class="card h-100 border-warning">
                        <div class="card-body">
                            <div class="position-relative">
                                <div class="podium podium-gold">
                                    <span class="position-number">1</span>
                                </div>
                                <h4 class="card-title text-warning">ü•á 1st Place</h4>
                                <h5 class="card-subtitle mb-2">{{ player_stats[0].player.name }}</h5>
                                <div class="stats">
                                    <p class="mb-1"><strong>Wins:</strong> {{ player_stats[0].wins }}</p>
                                    <p class="mb-1"><strong>Total Score:</strong> {{ player_stats[0].total_score }}</p>
                                    <p class="mb-1"><strong>Avg Score:</strong> {{ "%.1f"|format(player_stats[0].avg_score) }}</p>
                                    <p class="mb-0"><strong>Matches:</strong> {{ player_stats[0].matches_played }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3rd Place -->
                <div class="col-md-4 mb-3">
                    <div class="card h-100 border-warning">
                        <div class="card-body">
                            <div class="position-relative">
                                <div class="podium podium-bronze">
                                    <span class="position-number">3</span>
                                </div>
                                <h4 class="card-title text-warning">ü•â 3rd Place</h4>
                                <h5 class="card-subtitle mb-2">{{ player_stats[2].player.name }}</h5>
                                <div class="stats">
                                    <p class="mb-1"><strong>Wins:</strong> {{ player_stats[2].wins }}</p>
                                    <p class="mb-1"><strong>Total Score:</strong> {{ player_stats[2].total_score }}</p>
                                    <p class="mb-1"><strong>Avg Score:</strong> {{ "%.1f"|format(player_stats[2].avg_score) }}</p>
                                    <p class="mb-0"><strong>Matches:</strong> {{ player_stats[2].matches_played }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Full Rankings Table -->
    <div class="row">
        <div class="col-12">
            <h3 class="mb-3">üìä Complete Rankings</h3>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Matches Played</th>
                            <th>Wins</th>
                            <th>Total Score</th>
                            <th>Average Score</th>
                            <th>Win Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in range(player_stats|length) %}
                        <tr class="{% if i < 3 %}table-warning{% endif %}">
                            <td>
                                {% if i == 0 %}ü•á{% elif i == 1 %}ü•à{% elif i == 2 %}ü•â{% else %}{{ i + 1 }}{% endif %}
                            </td>
                            <td><strong>{{ player_stats[i].player.name }}</strong></td>
                            <td>{{ player_stats[i].matches_played }}</td>
                            <td>{{ player_stats[i].wins }}</td>
                            <td><strong>{{ player_stats[i].total_score }}</strong></td>
                            <td>{{ "%.1f"|format(player_stats[i].avg_score) }}</td>
                            <td>{{ "%.1f"|format(player_stats[i].win_rate * 100) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tournament Summary -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üìà Tournament Summary</h4>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h5>{{ player_stats|length }}</h5>
                            <p class="text-muted">Total Players</p>
                        </div>
                        <div class="col-md-3">
                            <h5>{{ matches|length }}</h5>
                            <p class="text-muted">Total Matches</p>
                        </div>
                        <div class="col-md-3">
                            <h5>{{ matches|map(attribute='round')|unique|list|length }}</h5>
                            <p class="text-muted">Rounds Played</p>
                        </div>
                        <div class="col-md-3">
                            <h5>{{ player_stats[0].total_score if player_stats else 0 }}</h5>
                            <p class="text-muted">Highest Score</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{{ url_for('tournament_detail', tournament_id=tournament.id) }}" class="btn btn-primary me-2">
                üìã View Tournament Details
            </a>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">
                üè† Back to Tournaments
            </a>
        </div>
    </div>
</div>

<style>
.podium {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-size: 24px;
    font-weight: bold;
}

.podium-gold {
    background: linear-gradient(45deg, #FFD700, #FFA500);
    color: white;
    box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
}

.podium-silver {
    background: linear-gradient(45deg, #C0C0C0, #A8A8A8);
    color: white;
    box-shadow: 0 4px 8px rgba(192, 192, 192, 0.3);
}

.podium-bronze {
    background: linear-gradient(45deg, #CD7F32, #A0522D);
    color: white;
    box-shadow: 0 4px 8px rgba(205, 127, 50, 0.3);
}

.position-number {
    font-size: 18px;
    font-weight: bold;
}

.stats p {
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
}
</style>
{% endblock %}
